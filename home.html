<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibio Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
   
    <style>
        body {
            background-color: #222;
            font-family: 'Nunito', sans-serif;
        }
        .header {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px;
        }
        .header .navbar-nav .nav-item {
            margin-right: 15px;
        }
        .header .nav-link {
            color: white;
            font-size: 1.2rem;
        }
        .header .nav-link:hover {
            background-color: orange;
            border-radius: 10px;
        }
        .header .navbar-brand {
            color: white;
            font-size: 1.5rem;
        }
        .username-display {
            color: white;
            font-size: 1.2rem;
            margin-left: 20px;
            top: 8px;
            position: relative;
        }
        .search-bar {
            margin: 20px;
        }
        .user-list, .message-list {
            color: white;
            margin: 20px;
        }
        .vibe-btn {
            background-color: rgb(35, 121, 232);
            color: white;
        }
        .message-container {
            display: none;
        }
        .chat-container {
            background-color: #333;
            padding: 20px;
            border-radius: 10px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
            display: none;
            z-index: 9999;
            transition: all 0.3s ease;
        }
        .chat-header {
            color: white;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-header .close-chat {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .chat-box {
            background-color: #444;
            padding: 10px;
            border-radius: 5px;
            height: calc(100vh - 120px);
            overflow-y: auto;
            color: white;
        }
        .chat-input {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-input input {
            width: 80%;
        }
        .chat-input button {
            width: 15%;
        }
        .message-item {
            padding: 10px;
            border-bottom: 10px solid #555;
            
        }
        .message-item:last-child {
            border-bottom: none;
        }
        .leaderboard {
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.leaderboard h2 {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
}

.top-three {
    display: flex;
    justify-content: space-around;
}

.rank-1, .rank-2, .rank-3 {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    width: 30%;
}

.rank-badge {
    font-size: 24px;
    font-weight: bold;
    color: gold;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin: 10px 0;
}

.username {
    display: block;
    font-size: 18px;
    font-weight: bold;
}

.vibe-count {
    display: block;
    font-size: 16px;
    margin: 10px 0;
}

.vibe-btn {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
}

.vibe-btn:hover {
    background-color: #218838;
}

.full-leaderboard-btn {
    display: block;
    margin: 20px auto;
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
}

.full-leaderboard-btn:hover {
    background-color: #0056b3;
}

#fullLeaderboard .rank {
    padding: 10px;
    background-color: #fff;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.hero {
  padding: 6.25rem 0px !important;
  margin: 0px !important;
  background-color: #111;
}
.cardbox {
  border-radius: 3px;
  margin-bottom: 20px;
  padding: 0px !important;
  width: 550px;
  background-color: #111;
}

/* ------------------------------- */
/* Cardbox Heading
---------------------------------- */
.cardbox .cardbox-heading {
  padding: 16px;
  margin: 0;
}
.cardbox .btn-flat.btn-flat-icon {
 border-radius: 50%;
 font-size: 24px;
 height: 32px;
 width: 32px;
 padding: 0;
 overflow: hidden;
 color: #fff !important;
 background: #111;
 
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
text-align: center;
}
.cardbox .float-right .dropdown-menu{
  position: relative;
  left: 13px !important;  
}
.cardbox .float-right a:hover{
  background: #f4f4f4 !important;	
}
.cardbox .float-right a.dropdown-item {
  display: block;
  width: 100%;
  padding: 4px 0px 4px 10px;
  clear: both;
  font-weight: 400;
  font-family: 'Abhaya Libre', serif;
  font-size: 14px !important;
  color: #848484;
  text-align: inherit;
  white-space: nowrap;
  background: 0 0;
  border: 0;
}

/* ------------------------------- */
/* Media Section
---------------------------------- */
.media {
  display: -ms-flexbox;
  display: flex;
  -ms-flex-align: start;
  align-items: flex-start;
}
.d-flex {
  display: -ms-flexbox !important;
  display: flex !important;
}
.media .mr-3{
  margin-right: 1rem !important;
}
.media img{
  width: 48px !important;
  height: 48px !important;
  padding: 2px;
  border: 2px solid #f4f4f4;
} 
.media-body {
  -ms-flex: 1;
  flex: 1;
  padding: .4rem !important;
}
.media-body p{
  font-family: 'Rokkitt', serif;	
  font-weight: 500 !important;
  font-size: 14px;
  color: #88898a;
}
.media-body small span{
  font-family: 'Rokkitt', serif;	
  font-size: 12px;
  color: #aaa;
  margin-right: 10px;
}


/* ------------------------------- */
/* Cardbox Item
---------------------------------- */
.cardbox .cardbox-item {
    position: relative;
    display: block;
}
.cardbox .cardbox-item img{
}
.img-responsive{
    display: block;
    max-width: 100%;
    height: auto;
}	
.fw {
    width: 100% !important;
	height: auto;
}


/* ------------------------------- */
/* Cardbox Base
---------------------------------- */
.cardbox-base{
 border-bottom: 2px solid #f4f4f4;
}	
.cardbox-base ul{
 margin: 10px 0px 10px 15px!important; 
 padding: 10px !important;
 font-size: 0px;	
  display: inline-block;
}
.cardbox-base li {
  list-style: none;
  margin: 0px 0px 0px -8px !important;
  padding: 0px 0px 0px 0px !important;
  display: inline-block;
}

.cardbox-base li a{
  margin: 0px !important;
  padding: 0px !important;
}
.cardbox-base li a i{
 position: relative;
 top: 4px; 
 font-size: 16px;
 color: #8d8d8d;
 margin-right: 15px;
}
.cardbox-base li a span{
 font-family: 'Rokkitt', serif;
 font-size: 14px;
 color: #8d8d8d;
 margin-left: 20px;
 position: relative;
 top: 5px; 
}
.cardbox-base li a em{
 font-family: 'Rokkitt', serif;
 font-size: 14px;
 color: #8d8d8d;
 position: relative;
 top: 3px; 
}
.cardbox-base li a img{
  width: 25px;
  height: 25px;
  margin: 0px !important;
  border: 2px solid #fff;
}


/* ------------------------------- */
/* Cardbox Comments
---------------------------------- */
.cardbox-comments{
  padding: 10px 40px 20px 40px !important;
  font-size: 0px;	
  text-align: center;
  display: inline-block;
}
.cardbox-comments .comment-avatar img{
  margin-top: 1px;
  margin-right: 10px;
  position: relative;
  display: inline-block;
  text-align: center;
  width: 40px;
  height: 40px;
}
.cardbox-comments .comment-body {
  overflow: auto;
}
.search {
 position: relative;
 right: -60px;
 top: -40px;
 margin-bottom: -40px;
 border: 2px solid #f4f4f4;	
 width: 60%;
 overflow: hidden;
 z-index: 1;
 height: 40px;
}
.search input[type="text"] {
 background-color: #fff;
 line-height: 10px;
 padding: 15px 60px 20px 10px;
 border: none;
 border-radius: 4px;
 width: 350px;
 font-family: 'Rokkitt', serif;
 font-size: 14px;
 color: #8d8d8d;
 height: inherit;
 font-weight: 700;
}
.search button {
 position: absolute;
 right: 0;
 top: 0px;
 border: none;
 background-color: transparent;
 color: #bbbbbb;
 padding: 15px 25px;
 cursor: pointer;
 
 display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
text-align: center;
}
.search button i {
 font-size: 20px;
 line-height: 30px;
 display: block;
}


/* ------------------------------- */
/* Author
---------------------------------- */
.author a{
 font-family: 'Rokkitt', serif;
 font-size: 16px;
 color: #00C4CF;
}
.author p{
 font-family: 'Rokkitt', serif;
 font-size: 16px;
 color: #8d8d8d;
}
/* General Styling for Post Card */


/* Like Button Styling */
.like-button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.like-button:hover {
    background-color: #0056b3;
}

/* Skeleton loader styles */
.skeleton-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.skeleton-cardbox {
    background: #f0f0f0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.skeleton-cardbox-heading {
    padding: 1rem;
    display: flex;
    align-items: center;
}

.skeleton-media {
    display: flex;
    align-items: center;
}

.skeleton-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e0e0e0;
}

.skeleton-info {
    margin-left: 1rem;
    flex: 1;
}

.skeleton-line {
    height: 10px;
    background: #e0e0e0;
    margin-bottom: 0.5rem;
    border-radius: 4px;
}

.skeleton-image {
    width: 100%;
    height: 200px;
    background: #e0e0e0;
}

.skeleton-cardbox-base {
    padding: 1rem;
}


    </style>
</head>
<body>
    <header class="header navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Vibio</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#" id="homeLink">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="exploreLink"onclick='display1()'>Explore</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="messagesLink" href='#'onclick='loadMessages();'>Messages <span id="pendingCount" class="badge bg-danger d-none">0</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="profileLink">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="postLink">Post</a>
                </li>
                <li class="nav-item">
                    <span class="username-display" id="username"></span>
                </li>
            </ul>
        </div>
    </header>

    <div class="container"id='sui'onclick='display1()'>
        <div class="search-bar" id="userSearchContainer">
            <input type="text" id="searchInput" class="form-control" placeholder="Search users...">
        </div>
        <div class="user-list" id="userList">
            <!-- Users will be dynamically added here -->
        </div>
      
      
    </div>
    <div class="message-container" id="messageContainer"style='z-index: 10000;'>
        <div class="message-list" id="messageList">
            <!-- Messages will be dynamically added here -->
        </div>
    </div>
    <div class="chat-container" id="chatContainer"style='z-index: 10000;'>
        <div class="chat-header">
            <h4 id="chatHeader">Chat with...</h4>
            <button class="close-chat" onclick="closeChat()">Ã—</button>
        </div>
        <div class="chat-box" id="chatBox">
            <!-- Chat messages will appear here -->
        </div>
        <div class="chat-input">
            <input type="text" id="chatMessage" class="form-control" placeholder="Type your message...">
            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
        </div>
    </div>
  
    <!-- Add a "Post" button to the header -->


<!-- Hidden div for post form -->
<div id="postForm" style="display:none;">
    <h3>Create a Post</h3>
    <input type="text" id="postTitle" placeholder="Post Title" class="form-control mb-2">
    <input type="file" id="postImage" class="form-control mb-2" accept="image/*">
    <div id="imagePreview" class="mb-2"></div>
    <button class="btn btn-primary" onclick="uploadPost()">Upload</button>
    <button class="btn btn-secondary" onclick="closePostForm()">Cancel</button>
</div>

<!-- Area to display posts -->
<!-- Skeleton loader HTML -->
<div id="skeletonContainer" class="skeleton-container"style='display:none;'>
    <!-- Repeat this div for each skeleton card you want to show -->
    <div class="skeleton-cardbox">
        <div class="skeleton-cardbox-heading">
            <div class="skeleton-media">
                <div class="skeleton-avatar"></div>
                <div class="skeleton-info">
                    <div class="skeleton-line" style="width: 60%;"></div>
                    <div class="skeleton-line" style="width: 40%;"></div>
                </div>
            </div>
        </div>
        <div class="skeleton-cardbox-item">
            <div class="skeleton-image"></div>
        </div>
        <div class="skeleton-cardbox-base">
            <div class="skeleton-line" style="width: 80%;"></div>
            <div class="skeleton-line" style="width: 60%;"></div>
        </div>
    </div>
</div>


<div id="postFeed"style='display:none;'></div>
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyDxS7qXtrtXJkES2kouqFEHmE13yak8zy8",
            authDomain: "vibio-1a11b.firebaseapp.com",
            projectId: "vibio-1a11b",
            storageBucket: "vibio-1a11b.appspot.com",
            messagingSenderId: "932933731183",
            appId: "1:932933731183:web:68b8497eb6442457ba1e9a"
        };
        firebase.initializeApp(firebaseConfig);

        function display1(){
            document.getElementById('sui').style='display:block;'
            loadUsers()
        }
        function toggleFullLeaderboard() {
    const leaderboard = document.getElementById('fullLeaderboard');
    if (leaderboard.style.display === 'none') {
        leaderboard.style.display = 'block';
    } else {
        leaderboard.style.display = 'none';
    }
}



        var db = firebase.firestore();

        // Function to display username from local storage
        function displayUsername() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (user && user.username) {
        if (user.username === 'NetSurfer') {
            // Display the username in golden with a crown icon
            document.getElementById('username').innerHTML = `<span style="color:gold;"><i class="fa-solid fa-crown"></i>Ancient Member ${user.username}</span>`;
        }if (user.username === 'KanhaFeb') {
            // Display the username in golden with a crown icon
            document.getElementById('username').innerHTML = `<span style="color:gold;"><i class="fa-solid fa-crown"></i>Ancient Member ${user.username}</span>`;
        } else {
            // Display the normal username
            document.getElementById('username').textContent = `Hello, ${user.username}`;
        }
    } else {
        document.getElementById('username').textContent = 'Hello, Guest';
    }
}


        // Function to fetch and display users from Firestore
        function loadUsers() {
    db.collection('users').get().then((querySnapshot) => {
        const userList = document.getElementById('userList');
        userList.innerHTML = ''; // Clear existing user list

        querySnapshot.forEach((doc) => {
            const user = doc.data();
            const userItem = document.createElement('div');
            userItem.className = 'd-flex justify-content-between align-items-center mb-2';

            // Check if the username is 'NetSurfer'
            if (user.username === 'NetSurfer') {
                userItem.innerHTML = `
                    <span style="color: gold;">
                        <i class="fa fa-crown"></i> ${user.username} (Our Ancient Member)
                    </span>
                    <button class="btn vibe-btn" onclick="sendVibe('${user.username}')">Vibe G</button>
                `;
            }  if (user.username === 'KanhaFeb') {
                userItem.innerHTML = `
                    <span style="color: gold;">
                        <i class="fa fa-crown"></i> ${user.username} (Our Ancient Member)
                    </span>
                    <button class="btn vibe-btn" onclick="sendVibe('${user.username}')">Vibe G</button>
                `;
            } else {
                userItem.innerHTML = `
                    <span>${user.username}</span>
                    <button class="btn vibe-btn" onclick="sendVibe('${user.username}')">Vibe</button>
                `;
            }

            userList.appendChild(userItem);
        });
    });
}

        // Function to send a vibe request
       // Function to send a vibe request
// Function to send a vibe request
function sendVibe(targetUsername) {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user && user.username) {
                db.collection('messages').add({
                    from: user.username,
                    to: targetUsername,
                    message: `You got vibed by ${user.username}`,
                    timestamp: new Date()
                }).then(() => {
                    alert(`Vibe request sent to ${targetUsername}`);
                }).catch((error) => {
                    console.error('Error sending vibe:', error);
                });
            } else {
                alert('Please log in to send a vibe.');
            }
        }

        // Function to fetch and display messages
        function loadMessages() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (user && user.username) {
        db.collection('messages').where('to', '==', user.username).get().then((querySnapshot) => {
            const messageList = document.getElementById('messageList');
            messageList.innerHTML = ''; // Clear existing messages

            querySnapshot.forEach((doc) => {
                const message = doc.data();
                const messageItem = document.createElement('div');
                messageItem.className = 'mb-2 d-flex justify-content-between align-items-center';
                messageItem.innerHTML = `
                    <strong>${message.from}:</strong> ${message.message}
                    <button class="btn btn-primary ms-2" onclick="openChat('${message.from}')">Message</button>
                `;
                messageList.appendChild(messageItem);
            });

            document.getElementById('userSearchContainer').style.display = 'none';
            
            document.getElementById('messageContainer').style.display = 'block';
            
            // Automatically open chat window if there's an active chat
            if (messageList.children.length > 0) {
                openChat(messageList.children[0].querySelector('button').onclick.toString().match(/'(.+?)'/)[1]);
            }
        }).catch((error) => {
            console.error('Error fetching messages:', error);
        });
    } else {
        alert('Please log in to view messages.');
    }
}


        // Function to open the chat window
        function openChat(username) {
            document.getElementById('chatHeader').textContent = `Chat with ${username}`;
            document.getElementById('chatContainer').style.display = 'block';
            loadChat(username);
        }

        // Function to close the chat window
        function closeChat() {
            document.getElementById('chatContainer').style.display = 'none';
        }

        // Function to load chat messages
        function loadChat(username) {
    const user = JSON.parse(localStorage.getItem('user'));
    if (user && user.username) {
        db.collection('chats').where('participants', 'array-contains', user.username).onSnapshot((querySnapshot) => {
            let chatDoc = null;
            querySnapshot.forEach((doc) => {
                const chat = doc.data();
                if (chat.participants.includes(user.username) && chat.participants.includes(username)) {
                    chatDoc = doc.ref;
                }
            });

            if (chatDoc) {
                chatDoc.onSnapshot((doc) => {
                    const chat = doc.data();
                    const chatBox = document.getElementById('chatBox');
                    chatBox.innerHTML = ''; // Clear existing chat messages

                    chat.messages.forEach((msg) => {
                        const messageItem = document.createElement('div');
                        messageItem.className = msg.sender === user.username ? 'text-end' : 'text-start';
                        messageItem.innerHTML = `<strong>${msg.sender}:</strong> ${msg.text}`;
                        chatBox.appendChild(messageItem);
                    });

                    chatBox.scrollTop = chatBox.scrollHeight; // Scroll to bottom
                });
            }
        });
    } else {
        alert('Please log in to view chat.');
    }
}


        // Function to send a message
        function sendMessage() {
    const user = JSON.parse(localStorage.getItem('user'));
    const messageInput = document.getElementById('chatMessage');
    const messageText = messageInput.value;
    const partner = document.getElementById('chatHeader').textContent.replace('Chat with ', '');

    if (user && user.username && messageText.trim()) {
        db.collection('chats').where('participants', 'array-contains', user.username).get().then((querySnapshot) => {
            let chatDoc = null;
            querySnapshot.forEach((doc) => {
                const chat = doc.data();
                if (chat.participants.includes(user.username) && chat.participants.includes(partner)) {
                    chatDoc = doc.ref;
                }
            });

            if (chatDoc) {
                chatDoc.update({
                    messages: firebase.firestore.FieldValue.arrayUnion({
                        id: new Date().toISOString(), // Add unique identifier
                        sender: user.username,
                        text: messageText,
                        timestamp: new Date()
                    })
                }).then(() => {
                    db.collection('messages').add({
                        from: user.username,
                        to: partner,
                        message: messageText,
                        timestamp: new Date()
                    }).then(() => {
                        messageInput.value = ''; // Clear input
                    }).catch((error) => {
                        console.error('Error adding message to sender\'s collection:', error);
                    });
                }).catch((error) => {
                    console.error('Error sending message:', error);
                });
            } else {
                db.collection('chats').add({
                    participants: [user.username, partner],
                    messages: [{
                        id: new Date().toISOString(), // Add unique identifier
                        sender: user.username,
                        text: messageText,
                        timestamp: new Date()
                    }]
                }).then(() => {
                    db.collection('messages').add({
                        from: user.username,
                        to: partner,
                        message: messageText,
                        timestamp: new Date()
                    }).then(() => {
                        messageInput.value = ''; // Clear input
                    }).catch((error) => {
                        console.error('Error adding message to sender\'s collection:', error);
                    });
                }).catch((error) => {
                    console.error('Error creating chat:', error);
                });
            }
        });
    }
}


        // Event listener for opening messages
        document.getElementById('postLink').addEventListener('click', function() {
        document.getElementById('postForm').style.display = 'block';
    });

    // Function to close the post form
    function closePostForm() {
        document.getElementById('postForm').style.display = 'none';
    }

    // Function to preview selected image
    document.getElementById('postImage').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" alt="Image Preview" style="max-width: 100%; height: auto;">`;
            };
            reader.readAsDataURL(file);
        }
    });

    // Function to upload post to Firebase
    function loadPosts() {
    const postsContainer = document.getElementById('postFeed');
    
    postsContainer.innerHTML = ''; // Clear existing posts
    

    // Fetch posts from Firestore
    db.collection('posts').get().then((querySnapshot) => {
        
        querySnapshot.forEach((doc) => {
            const post = doc.data();
            const postId = doc.id; // Get the document ID
            const username = post.username || 'Unknown User';
            const title = post.title || 'Untitled Post';
            const imageURL = post.imageURL || 'https://via.placeholder.com/600x400'; // Default placeholder image
            const location = post.location || 'Unknown Location';
            const timeAgo = new Date(post.timestamp.toDate()).toLocaleString(); // Format Firestore timestamp
            const likes = post.likes || 0;
            const comments = post.comments || 0;
            const shares = post.shares || 0;

            // Create the post card and append it to the container
            const postCard = `
                <center>
                    <div class="cardbox shadow-lg bg-white">
                        <div class="cardbox-heading">
                            <div class="media m-0">
                                <div class="media-body">
                                    <p class="m-0">${username}</p>
                                    <small><span><i class="icon ion-md-pin"></i> ${location}</span></small>
                                    <small><span><i class="icon ion-md-time"></i> ${timeAgo}</span></small>
                                </div>
                            </div><!--/ media -->
                        </div><!--/ cardbox-heading -->

                        <div class="cardbox-item">
                            <h5 class="m-3">${title}</h5>
                            <img class="img-fluid" src="${imageURL}" alt="Post Image">
                        </div><!--/ cardbox-item -->

                        <div class="cardbox-base">
                            <ul class="float-right">
                                <li><a><i class="fa fa-comments"style='position:relative;top:40px;left:250px;'></i></a></li>
                                <li><a><em class="mr-5"style='position:relative;top:40px;left:250px;'>${comments}</em></a></li>
                                <li><a><i class="fa fa-share-alt"style='position:relative;top:20px;left:300px;'></i></a></li>
                                <li><a><em class="mr-3"style='position:relative;top:20px;left:300px;'>${shares}</em></a></li>
                            </ul>
                            <ul>
                                <li><button style='position:relative;left:-240px;top:10px;' class="like-button" onclick="toggleLike('${postId}')"><i class="fa fa-thumbs-up"></i> Like</a></button>
                                <li><a><span style='position:relative;left:-240px;top:10px;' id="like-count-${postId}">${likes} Likes</span></a></li>
                            </ul>			   
                        </div><!--/ cardbox-base -->
                        
                       <div class="form-outline" data-mdb-input-init>
                           <input type="text" id="form12" class="form-control" placeholder='Enter Your comment'/>
                       </div>
                    </div>
                </center><!--/ cardbox -->
            `;

            // Append each post card to the posts container
            postsContainer.innerHTML += postCard;
        });
    }).catch((error) => {
        console.error('Error fetching posts:', error);
        
    });
}

// Call loadPosts on page load or whenever necessary
loadPosts();


// Function to handle liking a post
function toggleLike(postId) {
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user || !user.username) {
        alert('Please log in to like posts.');
        return;
    }

    const postRef = db.collection('posts').doc(postId);
    postRef.get().then((doc) => {
        if (doc.exists) {
            const post = doc.data();
            const currentLikes = post.likes || 0;
            const likedBy = post.likedBy || [];

            if (likedBy.includes(user.username)) {
                alert('You have already liked this post.');
                return;
            }

            // Update likes and likedBy array
            postRef.update({
                likes: currentLikes + 1,
                likedBy: firebase.firestore.FieldValue.arrayUnion(user.username)
            }).then(() => {
                // Update the like count on the UI
                loadPosts();
            }).catch((error) => {
                console.error('Error updating like count:', error);
            });
        } else {
            console.log('No such post!');
        }
    }).catch((error) => {
        console.error('Error getting post:', error);
    });
}

// Function to update the like count in the UI
function updateLikeCount(postId, delta) {
    const likeCountElement = document.getElementById(`like-count-${postId}`);
    if (likeCountElement) {
        let currentLikes = parseInt(likeCountElement.textContent, 10);
        likeCountElement.textContent = currentLikes + delta;
    }
}

        // Initialize the page
        displayUsername();
        loadChat()
       loadUsers()
       loadMessages()
    </script>
</body>
</html>
